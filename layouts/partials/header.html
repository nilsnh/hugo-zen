
{{ $baseurl := .Site.BaseURL }}

<!DOCTYPE html>
<html lang="{{ with .Params.languageCode }}{{ . }}{{ else }}{{ .Site.LanguageCode }}{{ end }}">
<head>
<meta charset="utf-8">
<link rel="icon" type="image/gif" href="/favicon.gif" />
{{ with .Site.Params.author }}
  <meta name="author" content="{{ . }}">
{{ end }}
{{ with .Site.Params.description }}
  <meta name="description" content="{{ . }}">
{{ end }}
{{ .Hugo.Generator }}
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/custom.css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="{{ .Site.Title }}">
<title>{{ $isHomePage := eq .Title .Site.Title }}{{ .Title }}{{ if eq $isHomePage false }} - {{ .Site.Title }}{{ end }}</title>

<!-- Facebook OGP markup -->
<meta property="og:title" content="{{ .Title }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:locale" content="{{ .Site.LanguageCode }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />

{{ if .IsPage }}
  <meta property="og:type" content="article" />
  <meta property="og:description" content="{{ .Summary }}" />
{{ else }}
  <meta property="og:type" content="website" />
  {{ with .Site.Params.description }}
    <meta property="og:description" content="{{ . }}" />
  {{ end }}
{{ end }}

<!-- Twitter card markup  -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{{ .Title }}" />
{{ with .Site.Params.twittername }}
  <meta name="twitter:site" content="@{{ . }}" />
{{ end }}
{{ if .IsPage }}
  <meta name="twitter:description" content="{{ .Summary }}" />
{{ else }}
  {{ with .Site.Params.description }}
    <meta name="twitter:description" content="{{ . }}" />
  {{ end }}
{{ end }}

<!-- Try to find first content image to be used as Facebook and Twitter markup. -->
{{ if .IsPage }}
  <!-- Create a list with first image we find in the content -->
  {{ $imageArray := findRE "[<img|.|\n]*src=\"(\\S*)\".*>" .Content 1}}
  <!-- Loop through the list of one or zero images. -->
  {{ range $imageArray }}
    <!-- Grab the url of the image element and add to scratch memory -->
    {{ $firstImageURL := replaceRE "[<img|.|\n]*src=\"(\\S*)\".*>" "$1" . }}
    {{ $.Scratch.Add "firstImage" $firstImageURL }}
  {{ end }}
  {{ if not ($.Scratch.Get "firstImage") }}
    {{ $.Scratch.Add "firstImage" .Site.Params.defaultBanner }}
  {{ end }}
{{ end }}

{{ if $.Scratch.Get "firstImage" }}
  <meta property="og:image"  content="{{ $.Scratch.Get "firstImage" | absURL }}"/>
  <meta name="twitter:image" content="{{ $.Scratch.Get "firstImage" | absURL }}"/>
  <meta property="og:image:width"  content="1000"/>
  <meta property="og:image:height"  content="646"/>
{{ end }}

<!-- Add JSON-ld to describe individual pages. -->
{{ if .IsPage }}
  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  "headline": "{{ .Title }}",
  {{ with $.Scratch.Get "firstImage" }}
    "image": [
      "{{ . | absURL }}"
     ],
  {{ end }}
  "datePublished": "{{ .Date.Format "2006-01-02" }}",
  "dateModified": "{{ .Lastmod.Format "2006-01-02" }}",
  "author": {
    "@type": "Person",
    "name": "{{ .Site.Params.author }}"
  },
   "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ .Site.Params.logo | absURL }}"
    }
  },
  "description": "{{ .Summary | plainify }}"
  }
  </script>
{{ end }}

{{ if $isHomePage }}
  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "Blog",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  "headline": "{{ .Site.Title }}",
  {{ with .Site.Params.defaultBanner }}
    "image": [
      "{{ . | absURL }}"
     ],
  {{ end }}
  "author": {
    "@type": "Person",
    "name": "{{ .Site.Params.author }}"
  },
   "publisher": {
    "@type": "Organization",
    "name": "{{ .Site.Title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ .Site.Params.logo | absURL }}"
    }
  },
  "description": "{{ .Site.Params.description }}"
  }
  </script>
{{ end }}

{{ with .Site.Params.indieAuthEndpoint }}
  <link rel="authorization_endpoint" href="{{.}}">
{{ end }}
{{ with .Site.Params.indieTokenEndpoint }}
  <link rel="token_endpoint" href="{{.}}">
{{ end }}
</head>
<body>
<div class="container">
  <header role="banner">
  <div class="header-logo">
  <a class="h-card" href="/"><img class="u-photo" src="{{ .Site.Params.logo }}" width="60" height="60" alt="{{ .Site.Title }}">
    {{with .Site.Params.author}}<span style="display:none;">{{.}}</span>{{end}}
    {{with .Site.Params.email}}<span rel="me" class="u-email" style="display:none;">{{.}}</span>{{end}}
    {{with .Site.Params.description}}<span rel="me" class="u-note" style="display:none;">{{.}}</span>{{end}}
  </a>
  </div>
  {{ if eq $isHomePage true }}
    <div class="header-content">
      <h1>{{ .Site.Title }}</h1>
      {{ if .Draft }}
      <h2><a href="/page/projects">projects</a></h2>
      {{ end }}
      <h2><a href="/page/talks">talks</a></h2>
      <h2><a href="/page/about">about</a></h2>
      <p class="header-content__description">{{ .Site.Params.description }}</p>
    </div>
  {{ end }}
  </header>
