
{{ $baseurl := .Site.BaseURL }}

<!DOCTYPE html>
<html lang="{{ with .Params.languageCode }}{{ . }}{{ else }}{{ .Site.LanguageCode }}{{ end }}">
<head>
<meta charset="utf-8">
<link rel="icon" type="image/gif" href="/favicon.gif" />
{{ with .Site.Params.author }}
  <meta name="author" content="{{ . }}">
{{ end }}
{{ with .Site.Params.description }}
  <meta name="description" content="{{ . }}">
{{ end }}
{{ .Hugo.Generator }}
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="//fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/custom.css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="{{ .Site.Title }}">
<title>{{ $isHomePage := eq .Title .Site.Title }}{{ .Title }}{{ if eq $isHomePage false }} - {{ .Site.Title }}{{ end }}</title>

<!-- Facebook OGP markup -->
<meta property="og:title" content="{{ .Title }}" />
<meta property="og:url" content="{{ .Permalink }}" />
<meta property="og:locale" content="{{ .Site.LanguageCode }}" />
<meta property="og:site_name" content="{{ .Site.Title }}" />

{{ if .IsPage }}
  <meta property="og:type" content="article" />
  <meta property="og:description" content="{{ .Summary }}" />
{{ else }}
  <meta property="og:type" content="website" />
  {{ with .Site.Params.description }}
    <meta property="og:description" content="{{ . }}" />
  {{ end }}
{{ end }}

<!-- Twitter card markup  -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{{ .Title }}" />
{{ with .Site.Params.twittername }}
  <meta name="twitter:site" content="@{{ . }}" />
{{ end }}
{{ if .IsPage }}
  <meta name="twitter:description" content="{{ .Summary }}" />
{{ else }}
  {{ with .Site.Params.description }}
    <meta name="twitter:description" content="{{ . }}" />
  {{ end }}
{{ end }}

<!-- Try to find first content image to be used as Facebook and Twitter markup. -->
{{ if .IsPage }}
  <!-- Create a list with first image we find in the content -->
  {{ $imageArray := findRE "[<img|.|\n]*src=\"(\\S*)\".*>" .Content 1}}
  <!-- Loop through the list of one or zero images. -->
  {{ range $imageArray }}
    <!-- Grab the url of the image element and add to scratch memory -->
    {{ $firstImageURL := replaceRE "[<img|.|\n]*src=\"(\\S*)\".*>" "$1" . }}
    {{ $.Scratch.Add "firstImage" $firstImageURL }}
  {{ end }}
{{ end }}

<!-- If we found an image in the content create meta tags for it. -->
{{ if $.Scratch.Get "firstImage" }}
  <meta property="og:image"  content="{{ $.Scratch.Get "firstImage" | absURL }}"/>
  <meta name="twitter:image" content="{{ $.Scratch.Get "firstImage" | absURL }}"/>
{{ else }}
  <!-- If we didn't find an image to use or we're at the Frontpage. Try to use default banner image. -->
  {{ with .Site.Params.defaultBanner }}
    <meta name="twitter:image" content="{{ . | absURL }}"/>
    <meta property="og:image"  content="{{ . | absURL }}"/>
    <meta property="og:image:width"  content="1000"/>
    <meta property="og:image:height"  content="646"/>
  {{ end }}
{{ end }}

{{ with .Site.Params.indieAuthEndpoint }}
  <link rel="authorization_endpoint" href="{{.}}">
{{ end }}
{{ with .Site.Params.indieTokenEndpoint }}
  <link rel="token_endpoint" href="{{.}}">
{{ end }}
</head>
<body>
<div class="container">

  <header role="banner">
  <div class="header-logo">
  <a class="h-card" href="/"><img class="u-photo" src="{{ .Site.Params.logo }}" width="60" height="60" alt="{{ .Site.Title }}">
    {{with .Site.Params.author}}<span style="display:none;">{{.}}</span>{{end}}
    {{with .Site.Params.email}}<span rel="me" class="u-email" style="display:none;">{{.}}</span>{{end}}
    {{with .Site.Params.description}}<span rel="me" class="u-note" style="display:none;">{{.}}</span>{{end}}
  </a>
  </div>
  {{ if eq $isHomePage true }}
    <div class="header-content">
      <h1 class="site-title">{{ .Site.Title }}</h1>
      {{ if .Draft }}
      <h2><a href="/page/projects">projects</a></h2>
      {{ end }}
      <h2><a href="/page/talks">talks</a></h2>
      <h2><a href="/page/about">about</a></h2>
    </div>
  {{ end }}
  </header>
